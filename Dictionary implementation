using System;
class Program
{
    static void Main()
    {
        MyDictionary<int, string> dict = new MyDictionary<int, string>();

        dict.Add(10, "A");
        dict.Add(17, "B");
        dict.Add(24, "C");

        if (dict.TryGetValue(17, out string value))
        {
            Console.WriteLine(value); // B
        }
    }
}

class MyDictionary<TKey, TValue>
{
    private int[] buckets;
    private Entry[] entries;
    private int count;
    private int capacity;

    private const int DefaultCapacity = 2;

    private struct Entry
    {
        public int hashCode;
        public int next;
        public TKey key;
        public TValue value;
    }

    private void Initialize(int size)
    {
        capacity = size;
        buckets = new int[capacity];
        entries = new Entry[capacity];

        for (int i = 0; i < capacity; i++)
            buckets[i] = -1;
    }

    public void Add(TKey key, TValue value)
    {
        if (buckets == null)
        {
            Initialize(DefaultCapacity);
        }

        if (count == capacity)
        {
            Resize();
        }

        int hashCode = key.GetHashCode() & 0x7FFFFFFF;
        int bucketIndex = hashCode % capacity;

        entries[count] = new Entry
        {
            hashCode = hashCode,
            key = key,
            value = value,
            next = buckets[bucketIndex]
        };

        buckets[bucketIndex] = count;
        count++;
    }

    private void Resize()
    {
        int newCapacity = capacity * 2 + 1;

        int[] newBuckets = new int[newCapacity];
        Entry[] newEntries = new Entry[newCapacity];

        for (int i = 0; i < newCapacity; i++)
            newBuckets[i] = -1;

        for (int i = 0; i < count; i++)
        {
            int newBucketIndex = entries[i].hashCode % newCapacity;

            newEntries[i] = entries[i];
            newEntries[i].next = newBuckets[newBucketIndex];
            newBuckets[newBucketIndex] = i;
        }

        buckets = newBuckets;
        entries = newEntries;
        capacity = newCapacity;
    }

    public bool TryGetValue(TKey key, out TValue value)
    {
        if (buckets == null)
        {
            value = default;
            return false;
        }

        int hashCode = key.GetHashCode() & 0x7FFFFFFF;
        int bucketIndex = hashCode % capacity;

        int index = buckets[bucketIndex];

        while (index != -1)
        {
            if (entries[index].hashCode == hashCode &&
                entries[index].key.Equals(key))
            {
                value = entries[index].value;
                return true;
            }

            index = entries[index].next;
        }

        value = default;
        return false;
    }
}
